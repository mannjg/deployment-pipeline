#!/bin/bash
# Infrastructure Configuration - Single Source of Truth
# Used by: local scripts, CI/CD pipelines, validation scripts
#
# Source this file: source config/infra.env

# =============================================================================
# GitLab
# =============================================================================
GITLAB_NAMESPACE="gitlab"
GITLAB_HOST_INTERNAL="gitlab.${GITLAB_NAMESPACE}.svc.cluster.local"
GITLAB_HOST_EXTERNAL="gitlab.jmann.local"
GITLAB_GROUP="p2c"

GITLAB_URL_INTERNAL="http://${GITLAB_HOST_INTERNAL}"
GITLAB_URL_EXTERNAL="https://${GITLAB_HOST_EXTERNAL}"

# Secrets
GITLAB_TOKEN_SECRET="gitlab-token"
GITLAB_TOKEN_KEY="token"

# GitLab user credentials (for scripts that need username)
GITLAB_USER_SECRET="gitlab-admin-credentials"
GITLAB_USER_KEY="username"

# Repository names
APP_REPO_NAME="example-app"
APP_CUE_NAME="exampleApp"  # CUE/manifest name (camelCase)
DEPLOYMENTS_REPO_NAME="k8s-deployments"

# Repository paths
APP_REPO_PATH="${GITLAB_GROUP}/${APP_REPO_NAME}"
DEPLOYMENTS_REPO_PATH="${GITLAB_GROUP}/${DEPLOYMENTS_REPO_NAME}"

# Repository URLs (internal)
APP_REPO_URL="${GITLAB_URL_INTERNAL}/${APP_REPO_PATH}.git"
DEPLOYMENTS_REPO_URL="${GITLAB_URL_INTERNAL}/${DEPLOYMENTS_REPO_PATH}.git"

# Repository URLs (external)
APP_REPO_URL_EXTERNAL="${GITLAB_URL_EXTERNAL}/${APP_REPO_PATH}.git"
DEPLOYMENTS_REPO_URL_EXTERNAL="${GITLAB_URL_EXTERNAL}/${DEPLOYMENTS_REPO_PATH}.git"

# =============================================================================
# Jenkins
# =============================================================================
JENKINS_NAMESPACE="jenkins"
JENKINS_HOST_INTERNAL="jenkins.${JENKINS_NAMESPACE}.svc.cluster.local"
JENKINS_HOST_EXTERNAL="jenkins.jmann.local"

JENKINS_URL_INTERNAL="http://${JENKINS_HOST_INTERNAL}:8080"
JENKINS_URL_EXTERNAL="https://${JENKINS_HOST_EXTERNAL}"

# Secrets
JENKINS_ADMIN_SECRET="jenkins-admin-credentials"
JENKINS_ADMIN_USER_KEY="username"
JENKINS_ADMIN_TOKEN_KEY="password"

# Job paths (MultiBranch Pipeline format: "job-name/job/branch")
JENKINS_APP_JOB_PATH="${APP_REPO_NAME}/job/main"

# Promotion job
JENKINS_PROMOTE_JOB_NAME="promote-environment"
JENKINS_AUTO_PROMOTE_JOB_NAME="k8s-deployments-auto-promote"

# =============================================================================
# ArgoCD
# =============================================================================
ARGOCD_HOST_INTERNAL="argocd-server.argocd.svc.cluster.local"
ARGOCD_HOST_EXTERNAL="argocd.jmann.local"

ARGOCD_URL_INTERNAL="http://${ARGOCD_HOST_INTERNAL}"
ARGOCD_URL_EXTERNAL="https://${ARGOCD_HOST_EXTERNAL}"

ARGOCD_NAMESPACE="argocd"

# =============================================================================
# Maven Repository / Container Registry
# =============================================================================
NEXUS_NAMESPACE="nexus"
MAVEN_REPO_HOST_INTERNAL="nexus.${NEXUS_NAMESPACE}.svc.cluster.local"
MAVEN_REPO_HOST_EXTERNAL="nexus.jmann.local"
CONTAINER_REGISTRY_HOST="docker.jmann.local"

MAVEN_REPO_URL_INTERNAL="http://${MAVEN_REPO_HOST_INTERNAL}:8081"
MAVEN_REPO_URL_EXTERNAL="https://${MAVEN_REPO_HOST_EXTERNAL}"

# Container registry
CONTAINER_REGISTRY_EXTERNAL="${CONTAINER_REGISTRY_HOST}"

# Secrets
NEXUS_ADMIN_SECRET="nexus-admin-credentials"
NEXUS_ADMIN_USER_KEY="username"
NEXUS_ADMIN_PASSWORD_KEY="password"

# =============================================================================
# Kubernetes Namespaces
# =============================================================================
DEV_NAMESPACE="dev"
STAGE_NAMESPACE="stage"
PROD_NAMESPACE="prod"

# =============================================================================
# k8s-deployments Pipeline Configuration
# =============================================================================
K8S_DEPLOYMENTS_REPO_PATH="p2c/k8s-deployments"
# Jenkins MultiBranch Pipeline job names (must match repo names)
K8S_DEPLOYMENTS_JOB="k8s-deployments"

# Timeouts (seconds)
K8S_DEPLOYMENTS_BUILD_TIMEOUT="${K8S_DEPLOYMENTS_BUILD_TIMEOUT:-300}"
PROMOTION_MR_TIMEOUT="${PROMOTION_MR_TIMEOUT:-180}"
