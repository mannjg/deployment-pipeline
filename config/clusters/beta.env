#!/usr/bin/env bash
# Cluster Configuration: beta
# Single infrastructure namespace with separate environment namespaces
#
# Source this file: source config/clusters/beta.env

# =============================================================================
# Cluster Identity
# =============================================================================
CLUSTER_NAME="beta"
PROTECTED="false"

# =============================================================================
# Storage
# =============================================================================
STORAGE_CLASS="microk8s-hostpath"

# =============================================================================
# Kubernetes Namespaces
# =============================================================================
# All infrastructure components share a single namespace
GITLAB_NAMESPACE="infra-beta"
JENKINS_NAMESPACE="infra-beta"
NEXUS_NAMESPACE="infra-beta"
ARGOCD_NAMESPACE="infra-beta"
DEV_NAMESPACE="dev-beta"
STAGE_NAMESPACE="stage-beta"
PROD_NAMESPACE="prod-beta"

# =============================================================================
# External Hostnames
# =============================================================================
GITLAB_HOST_EXTERNAL="gitlab-beta.jmann.local"
JENKINS_HOST_EXTERNAL="jenkins-beta.jmann.local"
MAVEN_REPO_HOST_EXTERNAL="nexus-beta.jmann.local"
ARGOCD_HOST_EXTERNAL="argocd-beta.jmann.local"
CONTAINER_REGISTRY_HOST="registry-dso.jmann.local"
CONTAINER_REGISTRY_PATH_PREFIX="p2c"

# =============================================================================
# GitLab
# =============================================================================
GITLAB_HOST_INTERNAL="gitlab.${GITLAB_NAMESPACE}.svc.cluster.local"
GITLAB_GROUP="p2c"

GITLAB_URL_INTERNAL="http://${GITLAB_HOST_INTERNAL}"
GITLAB_URL_EXTERNAL="https://${GITLAB_HOST_EXTERNAL}"

# Secrets
GITLAB_TOKEN_SECRET="gitlab-token"
GITLAB_TOKEN_KEY="token"

# GitLab user credentials
GITLAB_USER="root"
GITLAB_USER_SECRET="gitlab-admin-credentials"
GITLAB_USER_KEY="username"

# Repository names
APP_REPO_NAME="example-app"
APP_CUE_NAME="exampleApp"  # CUE/manifest name (camelCase)
DEPLOYMENTS_REPO_NAME="k8s-deployments"

# Repository paths
APP_REPO_PATH="${GITLAB_GROUP}/${APP_REPO_NAME}"
DEPLOYMENTS_REPO_PATH="${GITLAB_GROUP}/${DEPLOYMENTS_REPO_NAME}"

# Repository URLs (internal)
APP_REPO_URL="${GITLAB_URL_INTERNAL}/${APP_REPO_PATH}.git"
DEPLOYMENTS_REPO_URL="${GITLAB_URL_INTERNAL}/${DEPLOYMENTS_REPO_PATH}.git"

# Repository URLs (external)
APP_REPO_URL_EXTERNAL="${GITLAB_URL_EXTERNAL}/${APP_REPO_PATH}.git"
DEPLOYMENTS_REPO_URL_EXTERNAL="${GITLAB_URL_EXTERNAL}/${DEPLOYMENTS_REPO_PATH}.git"

# =============================================================================
# Jenkins
# =============================================================================
JENKINS_HOST_INTERNAL="jenkins.${JENKINS_NAMESPACE}.svc.cluster.local"

JENKINS_URL_INTERNAL="http://${JENKINS_HOST_INTERNAL}:8080"
JENKINS_URL_EXTERNAL="https://${JENKINS_HOST_EXTERNAL}"

# Secrets
JENKINS_ADMIN_SECRET="jenkins-admin-credentials"
JENKINS_ADMIN_USER_KEY="username"
JENKINS_ADMIN_TOKEN_KEY="password"

# Job paths (MultiBranch Pipeline format: "job-name/job/branch")
JENKINS_APP_JOB_PATH="${APP_REPO_NAME}/job/main"

# Promotion job
JENKINS_PROMOTE_JOB_NAME="promote-environment"
JENKINS_AUTO_PROMOTE_JOB_NAME="k8s-deployments-auto-promote"

# =============================================================================
# ArgoCD
# =============================================================================
ARGOCD_HOST_INTERNAL="argocd-server.${ARGOCD_NAMESPACE}.svc.cluster.local"

ARGOCD_URL_INTERNAL="http://${ARGOCD_HOST_INTERNAL}"
ARGOCD_URL_EXTERNAL="https://${ARGOCD_HOST_EXTERNAL}"

# =============================================================================
# Maven Repository / Container Registry
# =============================================================================
MAVEN_REPO_HOST_INTERNAL="nexus.${NEXUS_NAMESPACE}.svc.cluster.local"

MAVEN_REPO_URL_INTERNAL="http://${MAVEN_REPO_HOST_INTERNAL}:8081"
MAVEN_REPO_URL_EXTERNAL="https://${MAVEN_REPO_HOST_EXTERNAL}"

# Container registry
CONTAINER_REGISTRY_EXTERNAL="${CONTAINER_REGISTRY_HOST}"

# Secrets
NEXUS_ADMIN_SECRET="nexus-admin-credentials"
NEXUS_ADMIN_USER_KEY="username"
NEXUS_ADMIN_PASSWORD_KEY="password"

# =============================================================================
# k8s-deployments Pipeline Configuration
# =============================================================================
K8S_DEPLOYMENTS_REPO_PATH="${DEPLOYMENTS_REPO_PATH}"
# Jenkins MultiBranch Pipeline job names (must match repo names)
K8S_DEPLOYMENTS_JOB="k8s-deployments"

# Timeouts (seconds)
K8S_DEPLOYMENTS_BUILD_TIMEOUT="${K8S_DEPLOYMENTS_BUILD_TIMEOUT:-300}"
PROMOTION_MR_TIMEOUT="${PROMOTION_MR_TIMEOUT:-180}"
