---
# Pipeline Infrastructure Configuration
# =====================================
# This ConfigMap provides environment-specific configuration for CI/CD pipelines.
# It is mounted as environment variables in Jenkins agent pods.
#
# DEPLOYMENT:
#   Use envsubst to substitute variables before applying:
#   envsubst < pipeline-config.yaml | kubectl apply -f -
#
# REQUIRED VARIABLES:
#   ${GITLAB_HOST}      - GitLab hostname (e.g., gitlab.jmann.local)
#   ${JENKINS_HOST}     - Jenkins hostname (e.g., jenkins.jmann.local)
#   ${NEXUS_HOST}       - Nexus hostname (e.g., nexus.jmann.local)
#   ${ARGOCD_HOST}      - ArgoCD hostname (e.g., argocd.jmann.local)
#   ${DOCKER_REGISTRY}  - Docker registry external (e.g., docker.jmann.local)
#
# Naming convention (matches config/infra.env):
#   *_URL_INTERNAL  - Kubernetes service DNS names (pod-to-pod)
#   *_URL_EXTERNAL  - Ingress/external hostnames (user-facing)

apiVersion: v1
kind: ConfigMap
metadata:
  name: pipeline-config
  namespace: jenkins
  labels:
    app: jenkins
    component: pipeline-config
data:
  # ==========================================================================
  # GitLab Configuration
  # ==========================================================================
  GITLAB_URL_EXTERNAL: "https://${GITLAB_HOST}"
  GITLAB_URL_INTERNAL: "http://gitlab.gitlab.svc.cluster.local"
  GITLAB_GROUP: "p2c"

  # Repository URLs (internal - for pod-to-pod communication)
  APP_REPO_URL: "http://gitlab.gitlab.svc.cluster.local/p2c/example-app.git"
  DEPLOYMENTS_REPO_URL: "http://gitlab.gitlab.svc.cluster.local/p2c/k8s-deployments.git"

  # ==========================================================================
  # Jenkins Configuration
  # ==========================================================================
  JENKINS_URL_EXTERNAL: "https://${JENKINS_HOST}"
  JENKINS_URL_INTERNAL: "http://jenkins.jenkins.svc.cluster.local:8080"
  JENKINS_AGENT_IMAGE: "${DOCKER_REGISTRY}/jenkins/agent-custom:latest"

  # ==========================================================================
  # Nexus / Docker Registry Configuration
  # ==========================================================================
  NEXUS_URL_EXTERNAL: "https://${NEXUS_HOST}"
  NEXUS_URL_INTERNAL: "http://nexus.nexus.svc.cluster.local:8081"
  DOCKER_REGISTRY_EXTERNAL: "${DOCKER_REGISTRY}"
  DOCKER_REGISTRY_INTERNAL: "nexus.nexus.svc.cluster.local:5000"

  # ==========================================================================
  # ArgoCD Configuration
  # ==========================================================================
  ARGOCD_URL_EXTERNAL: "https://${ARGOCD_HOST}"
  ARGOCD_URL_INTERNAL: "http://argocd-server.argocd.svc.cluster.local"
  ARGOCD_SERVER: "argocd-server.argocd.svc.cluster.local:80"
  ARGOCD_OPTS: "--plaintext --grpc-web"

  # ==========================================================================
  # Git Configuration
  # ==========================================================================
  GIT_SSL_NO_VERIFY: "true"
