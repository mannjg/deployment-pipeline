---
# Pipeline Infrastructure Configuration
# This ConfigMap contains URLs for pipeline infrastructure services
# Update these values when deploying to a different cluster
#
# Variables (use envsubst before applying):
#   ${GITLAB_HOST} - GitLab hostname (e.g., gitlab.jmann.local)
#   ${JENKINS_HOST} - Jenkins hostname (e.g., jenkins.jmann.local)
#   ${NEXUS_HOST} - Nexus hostname (e.g., nexus.jmann.local)
#   ${ARGOCD_HOST} - ArgoCD hostname (e.g., argocd.jmann.local)
#   ${DOCKER_REGISTRY} - Docker registry (e.g., nexus.jmann.local:8082)

apiVersion: v1
kind: ConfigMap
metadata:
  name: pipeline-config
  namespace: jenkins
  labels:
    app: jenkins
    component: pipeline-config
data:
  # External URLs (for user-facing access, webhooks, etc.)
  GITLAB_EXTERNAL_URL: "https://${GITLAB_HOST}"
  JENKINS_EXTERNAL_URL: "https://${JENKINS_HOST}"
  NEXUS_EXTERNAL_URL: "https://${NEXUS_HOST}"
  ARGOCD_EXTERNAL_URL: "https://${ARGOCD_HOST}"

  # Internal URLs (for in-cluster communication)
  # These use Kubernetes service DNS for reliable pod-to-pod communication
  GITLAB_INTERNAL_URL: "http://gitlab.gitlab.svc.cluster.local"
  JENKINS_INTERNAL_URL: "http://jenkins.jenkins.svc.cluster.local:8080"
  NEXUS_INTERNAL_URL: "http://nexus.nexus.svc.cluster.local:8081"
  ARGOCD_INTERNAL_URL: "http://argocd-server.argocd.svc.cluster.local"

  # Docker registry for container images
  DOCKER_REGISTRY: "${DOCKER_REGISTRY}"

  # Git repository base paths
  GITLAB_GROUP: "root"

  # ArgoCD settings
  ARGOCD_SERVER: "argocd-server.argocd.svc.cluster.local:80"
  ARGOCD_OPTS: "--plaintext --grpc-web"

  # SSL verification (set to 'true' for self-signed certs)
  GIT_SSL_NO_VERIFY: "true"
