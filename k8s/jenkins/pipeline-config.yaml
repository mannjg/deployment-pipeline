---
# Pipeline Infrastructure Configuration
# =====================================
# This ConfigMap provides environment-specific configuration for CI/CD pipelines.
# It is mounted as environment variables in Jenkins agent pods.
#
# DEPLOYMENT:
#   Use envsubst to substitute variables before applying:
#   envsubst < pipeline-config.yaml | kubectl apply -f -
#
# REQUIRED VARIABLES:
#   ${GITLAB_HOST}      - GitLab hostname (e.g., gitlab.jmann.local)
#   ${JENKINS_HOST}     - Jenkins hostname (e.g., jenkins.jmann.local)
#   ${NEXUS_HOST}       - Nexus hostname (e.g., nexus.jmann.local)
#   ${ARGOCD_HOST}      - ArgoCD hostname (e.g., argocd.jmann.local)
#   ${DOCKER_REGISTRY}  - Docker registry external (e.g., docker.jmann.local)
#
# All *_INTERNAL_URL values use Kubernetes service DNS names
# All *_EXTERNAL_URL values use your ingress/external hostnames

apiVersion: v1
kind: ConfigMap
metadata:
  name: pipeline-config
  namespace: jenkins
  labels:
    app: jenkins
    component: pipeline-config
data:
  # ==========================================================================
  # GitLab Configuration
  # ==========================================================================
  GITLAB_EXTERNAL_URL: "https://${GITLAB_HOST}"
  GITLAB_INTERNAL_URL: "http://gitlab.gitlab.svc.cluster.local"
  GITLAB_GROUP: "root"

  # ==========================================================================
  # Jenkins Configuration
  # ==========================================================================
  JENKINS_EXTERNAL_URL: "https://${JENKINS_HOST}"
  JENKINS_INTERNAL_URL: "http://jenkins.jenkins.svc.cluster.local:8080"
  JENKINS_AGENT_IMAGE: "${DOCKER_REGISTRY}/jenkins/agent-custom:latest"

  # ==========================================================================
  # Nexus / Docker Registry Configuration
  # ==========================================================================
  NEXUS_EXTERNAL_URL: "https://${NEXUS_HOST}"
  NEXUS_INTERNAL_URL: "http://nexus.nexus.svc.cluster.local:8081"
  DOCKER_REGISTRY: "${DOCKER_REGISTRY}"
  DOCKER_REGISTRY_INTERNAL: "nexus.nexus.svc.cluster.local:5000"

  # ==========================================================================
  # ArgoCD Configuration
  # ==========================================================================
  ARGOCD_EXTERNAL_URL: "https://${ARGOCD_HOST}"
  ARGOCD_INTERNAL_URL: "http://argocd-server.argocd.svc.cluster.local"
  ARGOCD_SERVER: "argocd-server.argocd.svc.cluster.local:80"
  ARGOCD_OPTS: "--plaintext --grpc-web"

  # ==========================================================================
  # Git Configuration
  # ==========================================================================
  GIT_SSL_NO_VERIFY: "true"
