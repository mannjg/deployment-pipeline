# Harness Engineering Application Plan

Goal: Apply harness-engineering insights to this repo by making the system of record explicit, encoding invariants as checks, and increasing agent legibility and operability.

Non-goals (for this plan):
- Re-architecting the CI/CD topology or changing the Git remote strategy.
- Switching tooling (Jenkins/GitLab/ArgoCD/Nexus).

Assumptions:
- CLAUDE.md remains the authoritative agent entry point.
- Environment branches (dev/stage/prod) remain MR-only.

Definition of done:
- There is a short, up-to-date entry map for agents.
- Invariants are checked mechanically and are easy to run locally.
- Docs have explicit ownership/freshness signals.
- Agent-oriented operational status output is available.

## Recommended Order of Operations (Roadmap)
1) Session 1: Knowledge Map + Plan Index
2) Session 2: Encode Invariants in a Local Check (warn-only)
3) Session 3: Wire Invariant Checks Into CI (blocking)
4) Session 4: Agent-Oriented Status Summary
5) Session 5: Doc Gardening Automation
6) Session 6: Quality Scorecard (Lightweight)

## Session 1: Knowledge Map + Plan Index
Outcome: A small, discoverable map of docs and plans so agents can bootstrap fast.

Steps:
1) Create `docs/AGENTS.md` as a map-style entry point (no deep instructions).
2) Create `docs/INDEX.md` listing canonical docs, purpose, and last-reviewed dates.
3) Add `docs/plans/INDEX.md` listing plan documents and current status.
4) Link `docs/AGENTS.md` from `README.md` (one-line pointer).

Validation:
- `docs/AGENTS.md` fits on one screen and only links to existing sources of truth.
- `docs/INDEX.md` entries match actual files.

## Session 2: Encode Invariants in a Local Check
Outcome: A single script to enforce critical invariants and document remediation.

Steps:
1) Add `scripts/05-quality/verify-invariants.sh`.
2) Checks (initial set):
   - Block direct env branch modifications (validate last change path or require MR metadata if present).
   - Enforce subtree sync order guidance (ensure instructions are visible in output).
   - Run `cue vet ./...` for `k8s-deployments`.
3) Add brief help text when checks fail.

Validation:
- Script runs locally and exits non-zero on violation.
- Output includes exact remediation commands or docs to consult.

## Session 3: Wire Invariant Checks Into CI
Outcome: Invariants are enforced in CI and cannot be ignored.

Steps:
1) Add a Jenkins stage or job step that calls `scripts/05-quality/verify-invariants.sh`.
2) Ensure it runs for both `example-app` and `k8s-deployments` pipelines where applicable.
3) Update `docs/WORKFLOWS.md` with the new gate location.

Validation:
- CI fails on deliberate invariant violation (dry-run).
- CI logs show actionable guidance.

## Session 4: Agent-Oriented Status Summary
Outcome: Agents can fetch the system state with one command.

Steps:
1) Add `scripts/04-operations/status-summary.sh`.
2) Output: GitLab/Jenkins/Argo/Nexus availability, key job status, and active deployments.
3) Keep output short, grep-friendly, and stable.

Validation:
- Script runs without arguments.
- Output fits on one screen and has no empty/unstable lines.

## Session 5: Doc Gardening Automation
Outcome: Reduced doc drift and a recurring maintenance loop.

Steps:
1) Add a doc freshness checker (script or Jenkins job).
2) Define freshness rules (e.g., 90-day review window for operational docs).
3) Output a report to `docs/reports/` or Jenkins artifacts.
4) Update `docs/INDEX.md` with last-reviewed dates if changes are accepted.

Validation:
- Report lists stale docs with last-reviewed date and owning area.
- Report is easy to run locally.

## Session 6: Quality Scorecard (Lightweight)
Outcome: A simple, repeatable snapshot of repo health for agents.

Steps:
1) Add `docs/reports/quality-scorecard.md` generated by a script.
2) Include: invariants pass/fail, doc freshness, CI health, CUE validation result.
3) Link to scorecard from `docs/INDEX.md`.

Validation:
- Scorecard is generated in under 30 seconds locally.
- Scorecard references exact commands used.

## Risks and Mitigations
- Risk: Invariant checks are too strict and block legitimate work.
  Mitigation: Start in warn-only mode in Session 2, flip to blocking in Session 3.
- Risk: Docs become another maintenance burden.
  Mitigation: Keep freshness rules simple and automate reports.

## Optional Follow-ups
- Add a minimal "agent-runbook" for common operations (thin wrapper over existing scripts).
- Add a `docs/decisions/` record for major pipeline changes.
